<!DOCTYPE html>
<html>
<head>
<title>Admin Orders</title>
<style>
body{font-family:Arial;background:#f5f5f5;margin:0;padding:20px;}
.card{
background:white;
padding:15px;
margin:15px 0;
border-radius:10px;
box-shadow:0 0 10px #ccc;
}
button{
padding:6px 10px;
margin:3px;
border:none;
border-radius:5px;
cursor:pointer;
background:#ff4d4d;
color:white;
}
</style>
</head>
<body>

<h2>ðŸ“¦ Live Orders</h2>
<div id="orders">Loading...</div>

 <script>

function formatDate(time){
    if(!time) return "Not delivered yet";
    const d = new Date(time);
    return d.toLocaleString();
}


async function loadOrders(){
    const res = await fetch(window.location.origin + "/admin/orders");
    const orders = await res.json();

    const div = document.getElementById("orders");
    div.innerHTML="";

    orders.forEach(order=>{
        div.innerHTML+=`
        <div class="card">
        <b>Order #${order.id}</b><br>
        Name: ${order.customer_name}<br>
        Phone: ${order.phone}<br>
        Address: ${order.address}<br>
        Items: ${order.food_item}<br>
        Total: â‚¹${order.total_price}<br>

        Status: <b id="status-${order.id}">${order.status}</b><br>
        Delivered Time: <b>${formatDate(order.delivered_at)}</b><br><br>

        <button onclick="updateStatus(${order.id},'Accepted')">Accept</button>
        <button onclick="updateStatus(${order.id},'Preparing')">Preparing</button>
        <button onclick="updateStatus(${order.id},'Out for Delivery')">Out</button>
        <button onclick="updateStatus(${order.id},'Delivered')">Delivered</button>
        <button onclick="deleteOrder(${order.id})" style="background:#000;">Delete</button>
        </div>
        `;
    });
}

orders.forEach(order=>{
    if(order.status === "Delivered") return;   // hides completed orders

    div.innerHTML += `
    ... existing card ...
    `;
});

async function updateStatus(id,status){
   await fetch(window.location.origin + `/admin/update-status/${id}/${status}`,{
        method:"POST"
    });
    document.getElementById("status-"+id).innerText=status;
}

async function deleteOrder(id){


if(!confirm("Delete this order permanently?")) return;

fetch(window.location.origin + `/admin/delete-order/${id}`,{
    method:"DELETE"
});

// reload list
loadOrders();


}


// auto refresh every 5 seconds
setInterval(loadOrders,5000);
loadOrders();
</script>

</body>
</html>