<!DOCTYPE html>

<html>
<head>
<title>SMK Restaurant</title>

<style>
body{
font-family:Arial;
background:#f5f5f5;
text-align:center;
margin:0;
}

header{
background:#ff4d4d;
color:white;
padding:18px;
font-size:30px;
font-weight:bold;
}

.food{
background:white;
width:250px;
padding:15px;
margin:15px;
display:inline-block;
border-radius:12px;
box-shadow:0 0 10px #ccc;
}

button{
background:#28a745;
color:white;
border:none;
padding:10px 15px;
border-radius:6px;
cursor:pointer;
font-size:16px;
}

#cartBox{
position:fixed;
right:20px;
top:120px;
width:260px;
background:white;
padding:15px;
border-radius:12px;
box-shadow:0 0 15px #aaa;
}

#confirmBtn{
background:#ff4d4d;
width:100%;
margin-top:10px;
}
</style>

</head>

<body>

<header>üçî SMK Restaurant</header>

<h2>Menu</h2>
<div id="menu">Loading menu...</div>

<!-- CART -->

<div id="cartBox">
<h3>üõí Your Cart</h3>
<div id="cartItems">No items</div>
<h3>Total: ‚Çπ<span id="total">0</span></h3>
<button id="confirmBtn" onclick="confirmOrder()">Confirm Order</button>
</div>

<script>

let cart = {};
let total = 0;

/* LOAD MENU */
function loadMenu(){
fetch('/menu')
.then(res=>res.json())
.then(items=>{

const menuDiv=document.getElementById("menu");
menuDiv.innerHTML="";

items.forEach(item=>{
menuDiv.innerHTML+=`
<div class="food">
<h2>${item.item_name}</h2>
<p><b>‚Çπ${item.price}</b></p>
<button onclick="addToCart('${item.item_name}',${item.price})">Add</button>
</div>
`;
});

})
.catch(()=>{
document.getElementById("menu").innerHTML="Server not responding";
});
}

loadMenu();

/* ADD TO CART */
function addToCart(name,price){

if(!cart[name]){
cart[name]={qty:0,price:price};
}

cart[name].qty++;
updateCart();
}

/* UPDATE CART UI */
function updateCart(){

const cartDiv=document.getElementById("cartItems");
cartDiv.innerHTML="";
total=0;

for(let item in cart){
let qty=cart[item].qty;
let price=cart[item].price*qty;
total+=price;

cartDiv.innerHTML+=`${item} x${qty} = ‚Çπ${price}<br>`;
}

document.getElementById("total").innerText=total;
}

/* CONFIRM ORDER */
async function confirmOrder(){

if(total==0){
alert("Add items first");
return;
}

const name=localStorage.getItem("cust_name");
const phone=localStorage.getItem("cust_phone");
const address=localStorage.getItem("cust_address");

if(!name||!phone||!address){
alert("Enter details first");
window.location="/";
return;
}

/* create food string */
let itemsText="";
for(let item in cart){
itemsText+=`${item} x${cart[item].qty}, `;
}

const res=await fetch("/place-order",{
method:"POST",
headers:{"Content-Type":"application/json"},
body:JSON.stringify({
customer_name:name,
phone:phone,
address:address,
food_item:itemsText,
quantity:1,
total_price:total
})
});

const data=await res.json();

if(data.message){
alert("‚úÖ Order Placed!\nBill: ‚Çπ"+total);
window.location="/track.html";
}else{
alert("Order failed");
}

}

</script>

</body>
</html>


