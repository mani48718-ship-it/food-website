<!DOCTYPE html>

<html>
<head>
<title>SMK Restaurant</title>

<style>
body{
font-family:Arial;
background:#f5f5f5;
text-align:center;
margin:0;
}

header{
background:#ff4d4d;
color:white;
padding:18px;
font-size:30px;
font-weight:bold;
}

.food{
background:white;
width:250px;
padding:15px;
margin:15px;
display:inline-block;
border-radius:12px;
box-shadow:0 0 10px #ccc;
}

button{
background:#28a745;
color:white;
border:none;
padding:10px 15px;
border-radius:6px;
cursor:pointer;
font-size:16px;
}



#cartItems{
max-height:200px;
overflow-y:auto;
text-align:left;
margin-bottom:10px;
}

#confirmBtn{
background:#ff4d4d;
width:100%;
margin-top:10px;
}

/* ===== MAIN PAGE LAYOUT ===== */
.mainLayout{
display:flex;
align-items:flex-start;
}

/* LEFT SIDE (MENU) */
.menuArea{
width:75%;
padding:20px;
display:flex;
flex-wrap:wrap;
justify-content:center;
}

/* RIGHT SIDE (CART PANEL) */
#cartBox{
width:25%;
min-width:300px;
background:white;
padding:15px;
border-left:3px solid #eee;
height:calc(100vh - 80px);
position:sticky;
top:80px;
overflow-y:auto;
box-shadow:-3px 0 10px rgba(0,0,0,0.08);
}

/* CART ITEMS SCROLL */
#cartItems{
max-height:60vh;
overflow-y:auto;
text-align:left;
}

</style>

</head>

<body>

<header>üçî SMK Restaurant</header>

<div class="mainLayout">

    <!-- LEFT SIDE MENU -->
    <div class="menuArea">
        <h2 style="width:100%">Menu</h2>
        <div id="menu">Loading menu...</div>
    </div>

    <!-- RIGHT SIDE CART -->
    <div id="cartBox">
        <h3>üõí Your Cart</h3>
        <div id="cartItems">No items</div>
        <h3>Total: ‚Çπ<span id="total">0</span></h3>
        <button id="confirmBtn" onclick="confirmOrder()">Confirm Order</button>
    </div>

</div>

<script>

/* ---------- CART STORAGE ---------- */
let cart = JSON.parse(localStorage.getItem("cart")) || {};
let total = 0;

function saveCart(){
    localStorage.setItem("cart", JSON.stringify(cart));
}

/* ---------- LOAD MENU ---------- */
function loadMenu(){
fetch('/menu')
.then(res=>res.json())
.then(items=>{

const menuDiv=document.getElementById("menu");
menuDiv.innerHTML="";

items.forEach(item=>{
menuDiv.innerHTML += `
<div class="food">
    <h2>${item.item_name}</h2>
    <p><b>Price: ‚Çπ${item.price}</b></p>
    <button onclick="addToCart('${item.item_name}', ${item.price})">Add</button>
</div>`;
});
})
.catch(()=>{
document.getElementById("menu").innerHTML="Server not responding";
});
}

/* ---------- ADD ITEM ---------- */
function addToCart(name, price){
    if(!cart[name]){
        cart[name] = {qty:1,price:price};
    }else{
        cart[name].qty++;
    }
    saveCart();
    updateCart();
}

/* ---------- INCREASE ---------- */
function increaseQty(name){
    cart[name].qty++;
    saveCart();
    updateCart();
}

/* ---------- DECREASE ---------- */
function decreaseQty(name){
    if(!cart[name]) return;

    cart[name].qty--;

    if(cart[name].qty<=0){
        delete cart[name];
    }

    saveCart();
    updateCart();
}

/* ---------- UPDATE CART UI ---------- */
function updateCart(){

const cartDiv=document.getElementById("cartItems");
cartDiv.innerHTML="";
total=0;

for(let item in cart){

let qty=cart[item].qty;
let price=cart[item].price*qty;
total+=price;

cartDiv.innerHTML+=`
<div style="margin-bottom:10px;border-bottom:1px solid #eee;padding-bottom:8px;">
<b>${item}</b><br>

<button onclick="decreaseQty('${item}')" style="background:#dc3545;">‚àí</button>
<span style="margin:0 10px;">${qty}</span>
<button onclick="increaseQty('${item}')" style="background:#28a745;">+</button>

<div>‚Çπ${price}</div>
</div>`;
}

document.getElementById("total").innerText=total;
saveCart();
}

/* ---------- CONFIRM ORDER ---------- */
async function confirmOrder(){

if(total==0){
alert("Add items first");
return;
}

const name=localStorage.getItem("cust_name");
const phone=localStorage.getItem("cust_phone");
const address=localStorage.getItem("cust_address");

if(!name||!phone||!address){
alert("Enter details first");
window.location="/";
return;
}

let itemsText="";
for(let item in cart){
itemsText+=`${item} x${cart[item].qty}, `;
}

const res=await fetch("/place-order",{
method:"POST",
headers:{"Content-Type":"application/json"},
body:JSON.stringify({
customer_name:name,
phone:phone,
address:address,
food_item:itemsText,
quantity:1,
total_price:total
})
});

const data=await res.json();

if(data.message){
alert("‚úÖ Order Confirmed!");

localStorage.removeItem("cart");
cart={};
updateCart();

window.location.href="/track.html";
}else{
alert("Order failed");
}
}

/* ---------- PAGE LOAD ---------- */
window.onload=function(){
loadMenu();
updateCart();
};

</script>

</div>
</body>
</html>
