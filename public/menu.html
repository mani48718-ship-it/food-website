<!DOCTYPE html>

<html>
<head>
<title>SMK Restaurant</title>

<style>
body{
font-family:Arial;
background:#f5f5f5;
text-align:center;
margin:0;
}

header{
background:#ff4d4d;
color:white;
padding:18px;
font-size:30px;
font-weight:bold;
}

.food{
background:white;
width:250px;
padding:15px;
margin:15px;
display:inline-block;
border-radius:12px;
box-shadow:0 0 10px #ccc;
}

button{
background:#28a745;
color:white;
border:none;
padding:10px 15px;
border-radius:6px;
cursor:pointer;
font-size:16px;
}

#cartBox{
position:fixed;
bottom:20px;
right:20px;
width:260px;
max-height:70vh;
overflow:auto;
background:white;
padding:15px;
border-radius:14px;
box-shadow:0 8px 25px rgba(0,0,0,0.25);
z-index:999;
}

/* scroll cart items */
#cartItems{
max-height:200px;
overflow-y:auto;
text-align:left;
margin-bottom:10px;
}

/* MOBILE VIEW */
@media (max-width:600px){
#cartBox{
left:10px;
right:10px;
bottom:10px;
width:auto;
}
}

#confirmBtn{
background:#ff4d4d;
width:100%;
margin-top:10px;
}

#menu{
display:flex;
flex-wrap:wrap;
justify-content:center;
padding-bottom:160px; /* space for cart */
}

</style>

</head>

<body>

<header>üçî SMK Restaurant</header>

<h2>Menu</h2>
<div id="menu">Loading menu...</div>

<!-- CART -->

<div id="cartBox">
<h3>üõí Your Cart</h3>
<div id="cartItems">No items</div>
<h3>Total: ‚Çπ<span id="total">0</span></h3>
<button id="confirmBtn" onclick="confirmOrder()">Confirm Order</button>
</div>

<script>

/* LOAD CART FROM BROWSER MEMORY */
let cart = JSON.parse(localStorage.getItem("cart")) || {};
let total = 0;

/* SAVE CART */
function saveCart(){
localStorage.setItem("cart", JSON.stringify(cart));
}



/* LOAD MENU */
function loadMenu(){
fetch('/menu')
.then(res=>res.json())
.then(items=>{

const menuDiv=document.getElementById("menu");
menuDiv.innerHTML="";

items.forEach(item=>{
menuDiv.innerHTML += `

<div class="food">
    <h2>${item.item_name}</h2>
    <p><b>Price: ‚Çπ${item.price}</b></p>
    <button onclick="addToCart('${item.item_name}', ${item.price})">
        Add
    </button>
</div>
`;

});

})
.catch(()=>{
document.getElementById("menu").innerHTML="Server not responding";
});
}

window.onload = function(){
    loadMenu();
    updateCart();
}

function saveCart(){
    localStorage.setItem("cart", JSON.stringify(cart));
}

/* ADD TO CART */
function addToCart(name, price){


if(!cart[name]){
    cart[name] = { qty:1, price:price };
}else{
    cart[name].qty++;
}
/* INCREASE ITEM */
function increaseQty(name){
    cart[name].qty++;
    saveCart();
    updateCart();
}

/* DECREASE ITEM */
function decreaseQty(name){
    if(!cart[name]) return;

    cart[name].qty--;

    if(cart[name].qty <= 0){
        delete cart[name];
    }

    saveCart();
    updateCart();
}
saveCart();
updateCart();


}


/* UPDATE CART UI */
function updateCart(){


const cartDiv = document.getElementById("cartItems");
cartDiv.innerHTML = "";

total = 0;

for(let item in cart){

    let qty = cart[item].qty;
    let price = cart[item].price * qty;

    total += price;

    cartDiv.innerHTML += `
    <div style="margin-bottom:10px;">
        <b>${item}</b><br>

        <button onclick="decreaseQty('${item}')" 
        style="background:#dc3545;padding:5px 10px;">‚àí</button>

        <span style="margin:0 10px;">${qty}</span>

        <button onclick="increaseQty('${item}')" 
        style="background:#28a745;padding:5px 10px;">+</button>

        <div>‚Çπ${price}</div>
    </div>
    `;
}

document.getElementById("total").innerText = total;
saveCart();
}


/* CONFIRM ORDER */
async function confirmOrder(){

if(total==0){
alert("Add items first");
return;
}

const name=localStorage.getItem("cust_name");
const phone=localStorage.getItem("cust_phone");
const address=localStorage.getItem("cust_address");

if(!name||!phone||!address){
alert("Enter details first");
window.location="/";
return;
}

/* create food string */
let itemsText="";
for(let item in cart){
itemsText+=`${item} x${cart[item].qty}, `;
}

const res=await fetch("/place-order",{
method:"POST",
headers:{"Content-Type":"application/json"},
body:JSON.stringify({
customer_name:name,
phone:phone,
address:address,
food_item:itemsText,
quantity:1,
total_price:total
})
});

const data = await res.json();

if(data.message){
alert("‚úÖ Order Confirmed!");


// CLEAR CART AFTER SUCCESS
localStorage.removeItem("cart");
cart = {};
updateCart();

window.location.href="/track.html";


}else{
alert("Order failed");
}


}
window.onload = function(){
loadMenu();
updateCart();
}

</script>

</body>
</html>


