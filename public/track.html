<!DOCTYPE html>
<html>
<head>
    <title>Track Your Order</title>

    <!-- MAP FILES -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

    <style>
        body{
            font-family: Arial;
            background:#f5f5f5;
            text-align:center;
            padding-top:60px;
        }

        .box{
            background:white;
            width:360px;
            margin:auto;
            padding:25px;
            border-radius:12px;
            box-shadow:0 0 12px rgba(0,0,0,0.2);
        }

        input{
            padding:10px;
            width:85%;
            margin:10px;
            border-radius:6px;
            border:1px solid #ccc;
        }

        button{
            padding:10px 18px;
            background:#ff4d4d;
            color:white;
            border:none;
            border-radius:6px;
            cursor:pointer;
        }

        button:hover{
            background:#e43b3b;
        }

        .stage{
            margin:10px 0;
            padding:10px;
            border-radius:8px;
            text-align:left;
        }

        .done{
            background:#d4edda;
            color:#155724;
            font-weight:bold;
        }

        .pending{
            background:#eeeeee;
            color:#777;
        }

        .title{
            margin-bottom:10px;
        }
        .card{
background:white;
width:320px;
margin:80px auto;
padding:25px;
border-radius:12px;
box-shadow:0 0 12px #ccc;
text-align:center;
}

.card input{
width:90%;
padding:10px;
border-radius:6px;
border:1px solid #ccc;
}

.card button{
background:#ff4d4d;
color:white;
padding:12px 18px;
border:none;
border-radius:8px;
cursor:pointer;
}

    </style>
</head>

<body>

<header class="topHeader">
<div style="color:rgb(238, 84, 84);font-weight:bold;">ğŸ” SMK Restaurant</div>
<a href="/menu.html" class="trackBtn">ğŸ½ Back to Menu</a>
</header>

<div class="card">
<h2>ğŸ“¦ Track Your Order</h2>

<input id="phone" placeholder="Enter your phone number">
<br><br>
<button onclick="track()">Track Order</button>

<div id="result" style="margin-top:20px;font-size:18px;"></div>
<div id="map" style="height:400px; width:90%; margin:20px auto; border-radius:12px;"></div>
</div>


<script>

    // ===== MAP SETUP =====
let map;
let marker;

function initMap(){
    map = L.map('map').setView([17.3850, 78.4867], 13);

    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        attribution: 'Â© OpenStreetMap'
    }).addTo(map);

    marker = L.marker([17.3850, 78.4867]).addTo(map);
}

initMap();

// ===== TRACK FUNCTION =====

async function track(){

const phone=document.getElementById("phone").value;

if(!phone){
alert("Enter phone number");
return;
}

const res=await fetch("/track-order/"+phone);
const data=await res.json();

const result=document.getElementById("result");

if(data.found){

    let message = "";

    // Payment not verified yet
    if(data.status === "PENDING"){
        message = "ğŸŸ¡ Waiting for restaurant to verify your payment";
    }

    // Restaurant accepted payment
    else if(data.status === "CONFIRMED"){
        message = "ğŸŸ¢ Payment confirmed! Restaurant is preparing your food";
    }

    // Cooking done
    else if(data.status === "Ready"){
        message = "ğŸ‘¨â€ğŸ³ Your order is ready";
    }

    // Delivery started
    else if(data.status === "Out for Delivery"){
        message = "ğŸš´ Order is on the way";
    }

    // Completed
    else if(data.status === "Delivered"){
        message = "âœ… Order delivered. Enjoy your meal!";
    }

    result.innerHTML =
    "<b>Food:</b> "+data.food+
    "<br><b>Order Status:</b> "+message;

}else{
    result.innerHTML="No order found";
}
}


</script>

</body>
</html>
