<!DOCTYPE html>
<html>
<head>
    <title>SMK Restaurant</title>
    <style>
        body{
            font-family: Arial;
            background:#f5f5f5;
            text-align:center;
        }
        header{
            background:#ff4d4d;
            color:white;
            padding:15px;
            font-size:28px;
        }
        .food{
            background:white;
            width:250px;
            padding:15px;
            margin:20px;
            display:inline-block;
            border-radius:10px;
            box-shadow:0 0 10px #ccc;
        }
        button{
            background:#28a745;
            color:white;
            border:none;
            padding:10px;
            border-radius:5px;
            cursor:pointer;
        }
    </style>
</head>

<body>

<header>üçî SMK Restaurant</header>

<h2>Place Your Order</h2>

<div id="menu"></div>

<input id="name" placeholder="Your Name"><br><br> <input id="phone" placeholder="Phone Number"><br><br> <input id="address" placeholder="Delivery Address"><br><br>

<script>

function loadMenu(){
    fetch('/menu')
    .then(res => res.json())
    .then(items => {

        const menuDiv = document.getElementById("menu");
        menuDiv.innerHTML = "";

        items.forEach(item => {
            menuDiv.innerHTML += `
            <div class="food">
                <h2>${item.item_name}</h2>
                <p>Price: ‚Çπ${item.price}</p>
                <button onclick="placeOrder('${item.item_name}', ${item.price})">
                    Order Now
                </button>
            </div>
            `;
        });

    });
}

loadMenu();

</script>

<script>
async function placeOrder(item, price) {

  const name = document.getElementById("name").value;
  const phone = document.getElementById("phone").value;
  const address = document.getElementById("address").value;

  if(!name || !phone || !address){
    alert("Fill all details");
    return;
  }

  const paymentRes = await fetch("/create-payment", {
    method:"POST",
    headers:{ "Content-Type":"application/json" },
    body: JSON.stringify({ amount: price })
  });

  const paymentData = await paymentRes.json();

  const options = {
    key: "rzp_test_SKw7GuDrgFH2n2",
    amount: paymentData.amount,
    currency: "INR",
    name: "SMK Restaurant",
    order_id: paymentData.id,
    handler: async function (response){

      await fetch("/place-order", {
        method:"POST",
        headers:{ "Content-Type":"application/json" },
        body: JSON.stringify({
          customer_name: name,
          phone: phone,
          address: address,
          food_item: item,
          quantity: 1,
          total_price: price
        })
      });

      alert("Payment Successful & Order Placed");
      window.location.reload();
    }
  };

  const rzp = new Razorpay(options);
  rzp.open();
}
</script>

<script src="https://checkout.razorpay.com/v1/checkout.js"></script>
</body>
</html>
